<font face="微软雅黑"><font size="3">趁着Unity前几天更新了Unity ECS，正好把之前的坑填上。</font><br>
<font size="3"><br>
</font><br>
<div align="center">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171238" aid="171238" src="http://img.manew.com/data/attachment/forum/201812/07/145118j89efcwxc4tlenjo.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145118j89efcwxc4tlenjo.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/145118j89efcwxc4tlenjo.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1" initialized="true">

<div class="tip tip_4 aimg_tip" id="aimg_171238_menu" style="position: absolute; z-index: 301; left: 707px; top: 749px; display: none;" disautofocus="true" initialized="true">
<div class="xs0">
<p><strong>1.jpg</strong> <em class="xg1">(6.56 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjM4fDM0YTRmM2U0fDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171238" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171238&amp;handlekey=savephoto_171238">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:51">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<br>
<br>
<font size="3">在上一片文章我们动手体验了一下Unity ECS（Entities），尝试了一些基础操作。</font><br>
<font size="3"><br>
</font><br>
<font size="3">这次我们尝试用<strong>Job System</strong>优化我们的ECS实现，我们会把精力放在Job System之上，然后测试它在游戏帧数这种比较直观的参数上能拉开传统的<strong>Monobehaviour</strong>多大的差距。</font><br>
<font size="3"><br>
</font><br>
</font>

> <font face="微软雅黑"><font size="3">如果不熟悉Unity ECS，强烈推荐瞄一眼上一篇文章，熟悉ECS的核心概念与基础用法（<a href="http://www.manew.com/thread-141890-1-1.html" target="_blank">点击此处</a>）</font></font>

> <font face="微软雅黑"><font size="3"><br>
> </font></font>

<font face="微软雅黑">
<ignore_js_op>

<img id="aimg_171239" aid="171239" src="http://img.manew.com/data/attachment/forum/201812/07/145154ppmlo1hymipom7mz.gif" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145154ppmlo1hymipom7mz.gif" file="http://img.manew.com/data/attachment/forum/201812/07/145154ppmlo1hymipom7mz.gif" class="zoom" onclick="zoom(this, this.src, 0, 0, 0)" width="582" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" style="" _load="1" initialized="true">

<div class="tip tip_4 aimg_tip" id="aimg_171239_menu" style="position: absolute; z-index: 301; left: 510.625px; top: 1273px; display: none;" disautofocus="true" initialized="true">
<div class="xs0">
<p><strong>1.1.gif</strong> <em class="xg1">(2.82 MB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjM5fDgzMzk5ZTczfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171239" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171239&amp;handlekey=savephoto_171239">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:51">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><font size="3">我们打算做一个测试小游戏——疯狂吃豆人，游戏效果如下图所示：</font></font>

<font face="微软雅黑"><br>
<br>
<font size="3">我们先用<strong>Monobehavior</strong>（后文简称Mono）快速实现该游戏，然后再用Unity ECS尝试优化，对比两者后再看看会发生什么。相信大家都熟悉Mono的使用，我们需要实现以下几个功能：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<font size="3">1.玩家，敌人移动（不使用Unity的物理系统而是直接修改Transform）</font><br>
<font size="3">2.玩家碰撞检测（可以用一个简单的碰撞算法实现）</font><br>
<font size="3">3.敌人随机生成与销毁（需要一个单独的关卡系统控制敌人生成的位置与生成速度）</font><br>
<font size="3">首先我们创建两个<strong>Sphere</strong>放在场景中，然后创建两个新的<strong>Material</strong>，修改一下Shader改为Unlit/Color实现球体的扁平化风格，然后再设置一下颜色（玩家设置为橘色，敌人设置为蓝色）。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<font size="3">为了区分<strong>玩家</strong>与<strong>敌人</strong>，我们把橘色的材质<strong>挂载</strong>到玩家上，蓝色的材质挂载到敌人上。</font><br>
<font size="3">由于不使用Unity物理系统，所以我们移除掉两个球体上的<strong>Sphere Collider</strong>。</font><br>
<font size="3">记得设置一下他们的Tag，分别为<strong>Player</strong>与<strong>Enemy，</strong>别忘了把玩家跟敌人做成<strong>预制体</strong>。</font><br>
<font size="3">接着修改一下相机的Position为0, 0, -10。</font><br>
<br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171240" aid="171240" src="http://img.manew.com/data/attachment/forum/201812/07/145226b6q9r9w9g6x691g0.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145226b6q9r9w9g6x691g0.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/145226b6q9r9w9g6x691g0.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1" initialized="true">

<div class="tip tip_4 aimg_tip" id="aimg_171240_menu" style="position: absolute; z-index: 301; left: 654.625px; top: 2264px; display: none;" disautofocus="true" initialized="true">
<div class="xs0">
<p><strong>2.jpg</strong> <em class="xg1">(26 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjQwfDRjOGMxZmFmfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171240" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171240&amp;handlekey=savephoto_171240">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:52">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><br>
<br>
<font size="3">设置Size调整屏幕的显示大小，在Projection中把透视改为正交。</font><font size="3"><br>
</font><font size="3">创建Canvsa并且添加上敌人数量（EnemyCountText）这个Text：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<div style="width: 100px; height: 100px;background: url(static/image/common/loading.gif) no-repeat center center;"></div><img style="cursor: pointer; height: 1px; width: 1px;" id="aimg_171241" aid="171241" src="http://img.manew.com/data/attachment/forum/201812/07/145242hqzukznyy1qe5yp2.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145242hqzukznyy1qe5yp2.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/145242hqzukznyy1qe5yp2.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true">

<div class="tip tip_4 aimg_tip" id="aimg_171241_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>3.jpg</strong> <em class="xg1">(6.59 KB, 下载次数: 1)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjQxfGYxMjg1ZmFhfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171241" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171241&amp;handlekey=savephoto_171241">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:52">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><br>
<font size="3">字体设置就是这样</font><font size="3">准备工作完成后画面看上去是这样的：</font><br>
<font size="3"><br>
</font><br>
<div align="center">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171242" aid="171242" src="http://img.manew.com/data/attachment/forum/201812/07/145327v7auud96ao3rmomu.png.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145327v7auud96ao3rmomu.png" file="http://img.manew.com/data/attachment/forum/201812/07/145327v7auud96ao3rmomu.png.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1" initialized="true">

<div class="tip tip_4 aimg_tip" id="aimg_171242_menu" style="position: absolute; z-index: 301; left: 604px; top: 2945px; display: none;" disautofocus="true" initialized="true">
<div class="xs0">
<p><strong>4.png</strong> <em class="xg1">(9.69 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjQyfGQ0NDAxOTVmfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171242" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171242&amp;handlekey=savephoto_171242">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:53">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<br>
</font>

> <font face="微软雅黑"><font size="3">程序员审美，简单颜色跟纯黑背景</font></font>

> <font face="微软雅黑"><font size="3"><br>
> </font></font>

<font face="微软雅黑"><div align="center">
<ignore_js_op>

<div style="width: 100px; height: 100px;background: url(static/image/common/loading.gif) no-repeat center center;"></div><img style="cursor: pointer; height: 1px; width: 1px;" id="aimg_171243" aid="171243" src="http://img.manew.com/data/attachment/forum/201812/07/145358ibmwba3qmdvwz6vd.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145358ibmwba3qmdvwz6vd.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/145358ibmwba3qmdvwz6vd.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true">

<div class="tip tip_4 aimg_tip" id="aimg_171243_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>5.jpg</strong> <em class="xg1">(10.18 KB, 下载次数: 1)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjQzfGVmOTc5YzVhfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171243" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171243&amp;handlekey=savephoto_171243">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:53">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<font size="3"><br>
</font><font size="3">搭建好场景后我们先从创建一个<strong>Player</strong>类开始，并挂载到玩家身上来实现玩家的移动。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="0">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="0">复制代码</em></div><div><div id="highlighter_628532" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine;</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">Player </code><code class="applescript color1">:</code> <code class="applescript plain">MonoBehaviour</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public bool Dead;</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private float speed;</code></div><div class="line number5 index5 alt2">&nbsp;</div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Start</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">&gt;</code> <code class="applescript plain">speed </code><code class="applescript color2">=</code> <code class="applescript color1">5</code><code class="applescript plain">;</code></div><div class="line number7 index7 alt2">&nbsp;</div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Update</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float x </code><code class="applescript color2">=</code> <code class="applescript plain">Input.GetAxisRaw</code><code class="applescript color1">(</code><code class="applescript string">"Horizontal"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float y </code><code class="applescript color2">=</code> <code class="applescript plain">Input.GetAxisRaw</code><code class="applescript color1">(</code><code class="applescript string">"Vertical"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Vector</code><code class="applescript color1">3</code> <code class="applescript plain">vector </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">Vector</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">x</code><code class="applescript color1">,</code> <code class="applescript plain">y</code><code class="applescript color1">,</code> <code class="applescript color1">0</code><code class="applescript color1">)</code><code class="applescript plain">.normalized </code><code class="applescript color2">*</code> <code class="applescript plain">speed </code><code class="applescript color2">*</code> <code class="applescript plain">Time.deltaTime;</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">transform.</code><code class="applescript color3">position</code> <code class="applescript color2">+</code><code class="applescript color2">=</code> <code class="applescript plain">vector;</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number15 index15 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
</font>

> <font face="微软雅黑"><font size="3">代码是不是异常简单，估计初学三天的同学也可以轻松实现角色的移动，但看到后面，嘿嘿嘿嘿。</font></font>

<font face="微软雅黑"><font size="3">还有一个更简单的摄像机跟随脚本：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="1">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="1">复制代码</em></div><div><div id="highlighter_931161" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">1</div><div class="line number2 index2 alt1">2</div><div class="line number3 index3 alt2">3</div><div class="line number4 index4 alt1">4</div><div class="line number5 index5 alt2">5</div><div class="line number6 index6 alt1">6</div><div class="line number7 index7 alt2">7</div><div class="line number8 index8 alt1">8</div><div class="line number9 index9 alt2">9</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine;</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">CameraFollow </code><code class="applescript color1">:</code> <code class="applescript plain">MonoBehaviour</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private GameObject player;</code></div><div class="line number4 index4 alt1">&nbsp;</div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Start</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">&gt;</code> <code class="applescript plain">player </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.FindWithTag</code><code class="applescript color1">(</code><code class="applescript string">"Player"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number6 index6 alt1">&nbsp;</div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Update</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">&gt;</code> <code class="applescript plain">transform.</code><code class="applescript color3">position</code> <code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">Vector</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">player.transform.</code><code class="applescript color3">position</code><code class="applescript plain">.x</code><code class="applescript color1">,</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">player.transform.</code><code class="applescript color3">position</code><code class="applescript plain">.y</code><code class="applescript color1">,</code> <code class="applescript plain">gameObject.transform.</code><code class="applescript color3">position</code><code class="applescript plain">.z</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number9 index9 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">接着创建一个<strong>Enemy</strong>脚本挂载在敌人预制体上，提供一个供敌人生成器调用的接口，并且利用一个求两个圆相交或相切的算法实现碰撞。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="2">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="2">复制代码</em></div><div><div id="highlighter_349754" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div><div class="line number36 index36 alt1">36</div><div class="line number37 index37 alt2">37</div><div class="line number38 index38 alt1">38</div><div class="line number39 index39 alt2">39</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine;</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">Enemy </code><code class="applescript color1">:</code> <code class="applescript plain">MonoBehaviour</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private EnemySpawn spawn;</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private float speed;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private Player player;</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private float radius;</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private float playerRadius;</code></div><div class="line number8 index8 alt1">&nbsp;</div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">预留接口</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Init</code><code class="applescript color1">(</code><code class="applescript plain">EnemySpawn spawn</code><code class="applescript color1">,</code> <code class="applescript plain">float speed</code><code class="applescript color1">,</code> <code class="applescript plain">Player player</code><code class="applescript color1">)</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.spawn </code><code class="applescript color2">=</code> <code class="applescript plain">spawn;</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.speed </code><code class="applescript color2">=</code> <code class="applescript plain">speed;</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.player </code><code class="applescript color2">=</code> <code class="applescript plain">player;</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number16 index16 alt1">&nbsp;</div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Start</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Renderer renderer </code><code class="applescript color2">=</code> <code class="applescript plain">GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">Renderer</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Renderer playerRenderer </code><code class="applescript color2">=</code> <code class="applescript plain">player.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">Renderer</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">radius </code><code class="applescript color2">=</code> <code class="applescript plain">renderer.</code><code class="applescript color3">bounds</code><code class="applescript plain">.size.x </code><code class="applescript color2">/</code> <code class="applescript color1">2</code><code class="applescript plain">;</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">playerRadius </code><code class="applescript color2">=</code> <code class="applescript plain">playerRenderer.</code><code class="applescript color3">bounds</code><code class="applescript plain">.size.x </code><code class="applescript color2">/</code> <code class="applescript color1">2</code><code class="applescript plain">;</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number24 index24 alt1">&nbsp;</div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Update</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">敌人寻路</code></div><div class="line number28 index28 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Vector</code><code class="applescript color1">3</code> <code class="applescript plain">vector </code><code class="applescript color2">=</code> <code class="applescript color1">(</code><code class="applescript plain">player.transform.</code><code class="applescript color3">position</code> <code class="applescript color2">-</code> <code class="applescript plain">transform.</code><code class="applescript color3">position</code><code class="applescript color1">)</code><code class="applescript plain">.normalized </code><code class="applescript color2">*</code></div><div class="line number29 index29 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Time.deltaTime </code><code class="applescript color2">*</code> <code class="applescript plain">speed;</code></div><div class="line number30 index30 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">transform.</code><code class="applescript color3">position</code> <code class="applescript color2">+</code><code class="applescript color2">=</code> <code class="applescript plain">vector;</code></div><div class="line number31 index31 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">碰撞检测</code></div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float distance </code><code class="applescript color2">=</code> <code class="applescript color1">(</code><code class="applescript plain">player.transform.</code><code class="applescript color3">position</code> <code class="applescript color2">-</code> <code class="applescript plain">transform.</code><code class="applescript color3">position</code><code class="applescript color1">)</code><code class="applescript plain">.magnitude;</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">distance </code><code class="applescript color2">&lt;</code> <code class="applescript plain">radius </code><code class="applescript color2">+</code> <code class="applescript plain">playerRadius </code><code class="applescript color2">&amp;</code><code class="applescript color2">&amp;</code> <code class="applescript plain">!player.Dead</code><code class="applescript color1">)</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number35 index35 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Destroy</code><code class="applescript color1">(</code><code class="applescript plain">gameObject</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number36 index36 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">spawn.EnemyCount</code><code class="applescript comments">--;</code></div><div class="line number37 index37 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number38 index38 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number39 index39 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">Player跟Enemy脚本都已经实现，还需要一个创建Enemy的脚本<strong>EnemySpawn</strong>放在场景中当作一个计时器，每隔一定时间就在玩家身边创建一堆敌人。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="3">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="3">复制代码</em></div><div><div id="highlighter_993468" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div><div class="line number36 index36 alt1">36</div><div class="line number37 index37 alt2">37</div><div class="line number38 index38 alt1">38</div><div class="line number39 index39 alt2">39</div><div class="line number40 index40 alt1">40</div><div class="line number41 index41 alt2">41</div><div class="line number42 index42 alt1">42</div><div class="line number43 index43 alt2">43</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine;</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">EnemySpawn </code><code class="applescript color1">:</code> <code class="applescript plain">MonoBehaviour</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[HideInInspector]</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public int EnemyCount;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[SerializeField]</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private GameObject enemyPrefab;</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private Player player;</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private float cooldown;</code></div><div class="line number9 index9 alt2">&nbsp;</div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Start</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">&gt;</code> <code class="applescript plain">player </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.FindWithTag</code><code class="applescript color1">(</code><code class="applescript string">"Player"</code><code class="applescript color1">)</code><code class="applescript plain">.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">Player</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number11 index11 alt2">&nbsp;</div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Update</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">player.Dead</code><code class="applescript color1">)</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code><code class="applescript plain">;</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">cooldown </code><code class="applescript color2">+</code><code class="applescript color2">=</code> <code class="applescript plain">Time.deltaTime;</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">cooldown </code><code class="applescript color2">&gt;</code><code class="applescript color2">=</code> <code class="applescript color1">0.1</code><code class="applescript plain">f</code><code class="applescript color1">)</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">cooldown </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">f;</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Spawn</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number23 index23 alt2">&nbsp;</div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Spawn</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Vector</code><code class="applescript color1">3</code> <code class="applescript plain">playerPos </code><code class="applescript color2">=</code> <code class="applescript plain">player.transform.</code><code class="applescript color3">position</code><code class="applescript plain">;</code></div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">for</code> <code class="applescript color1">(</code><code class="applescript plain">int i </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">; i </code><code class="applescript color2">&lt;</code> <code class="applescript color1">50</code><code class="applescript plain">; i</code><code class="applescript color2">+</code><code class="applescript color2">+</code><code class="applescript color1">)</code></div><div class="line number28 index28 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number29 index29 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">GameObject enemy </code><code class="applescript color2">=</code> <code class="applescript plain">Instantiate</code><code class="applescript color1">(</code><code class="applescript plain">enemyPrefab</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number30 index30 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">EnemyCount</code><code class="applescript color2">+</code><code class="applescript color2">+</code><code class="applescript plain">;</code></div><div class="line number31 index31 alt2">&nbsp;</div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">int angle </code><code class="applescript color2">=</code> <code class="applescript plain">Random.Range</code><code class="applescript color1">(</code><code class="applescript color1">1</code><code class="applescript color1">,</code> <code class="applescript color1">360</code><code class="applescript color1">)</code><code class="applescript plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">在玩家什么角度刷出来</code><code class="applescript color1">(</code><code class="applescript color1">1</code><code class="applescript color1">-359</code><code class="applescript color1">)</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float distance </code><code class="applescript color2">=</code> <code class="applescript plain">Random.Range</code><code class="applescript color1">(</code><code class="applescript color1">15</code><code class="applescript plain">f</code><code class="applescript color1">,</code> <code class="applescript color1">25</code><code class="applescript plain">f</code><code class="applescript color1">)</code><code class="applescript plain">; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">距离玩家多远刷出来</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">角度与距离确定好之后算一下Enemy的初始坐标</code></div><div class="line number35 index35 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float y </code><code class="applescript color2">=</code> <code class="applescript plain">Mathf.Sin</code><code class="applescript color1">(</code><code class="applescript plain">angle</code><code class="applescript color1">)</code> <code class="applescript color2">*</code> <code class="applescript plain">distance;</code></div><div class="line number36 index36 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float x </code><code class="applescript color2">=</code> <code class="applescript plain">y </code><code class="applescript color2">/</code> <code class="applescript plain">Mathf.Tan</code><code class="applescript color1">(</code><code class="applescript plain">angle</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number37 index37 alt2">&nbsp;</div><div class="line number38 index38 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemy.transform.</code><code class="applescript color3">position</code> <code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">Vector</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">playerPos.x </code><code class="applescript color2">+</code> <code class="applescript plain">x</code><code class="applescript color1">,</code> <code class="applescript plain">playerPos.y </code><code class="applescript color2">+</code> <code class="applescript plain">y</code><code class="applescript color1">,</code> <code class="applescript color1">0</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number39 index39 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Enemy enemyScript </code><code class="applescript color2">=</code> <code class="applescript plain">enemy.AddComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">Enemy</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number40 index40 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemyScript.Init</code><code class="applescript color1">(</code><code class="applescript plain">this</code><code class="applescript color1">,</code> <code class="applescript color1">2.5</code><code class="applescript plain">f</code><code class="applescript color1">,</code> <code class="applescript plain">player</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number41 index41 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number42 index42 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number43 index43 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">设置场景中的EnemySpawn：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171249" aid="171249" src="http://img.manew.com/data/attachment/forum/201812/07/145943zmvdazcizadvamzi.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/145943zmvdazcizadvamzi.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/145943zmvdazcizadvamzi.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171249_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>6.jpg</strong> <em class="xg1">(4.9 KB, 下载次数: 1)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjQ5fDRlNTY1ZDgyfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171249" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171249&amp;handlekey=savephoto_171249">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 14:59">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><br>
<font size="3">把敌人的预制体放上去</font><font size="3"><br>
</font><font size="3">最后把控制的UI脚本加上挂载到场景中就大功告成了。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="4">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="4">复制代码</em></div><div><div id="highlighter_923011" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine;</code></div><div class="line number1 index1 alt2"><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine.UI;</code></div><div class="line number2 index2 alt1"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">UI </code><code class="applescript color1">:</code> <code class="applescript plain">MonoBehaviour</code></div><div class="line number3 index3 alt2"><code class="applescript color1">{</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private Text enemyCountText;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">private EnemySpawn enemySpawn;</code></div><div class="line number6 index6 alt1">&nbsp;</div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Start</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemyCountText </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.Find</code><code class="applescript color1">(</code><code class="applescript string">"EnemyCountText"</code><code class="applescript color1">)</code><code class="applescript plain">.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">Text</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemySpawn </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.Find</code><code class="applescript color1">(</code><code class="applescript string">"EnemySpawn"</code><code class="applescript color1">)</code><code class="applescript plain">.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">EnemySpawn</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number12 index12 alt1">&nbsp;</div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void Update</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">&gt;</code> <code class="applescript plain">enemyCountText.</code><code class="applescript color3">text</code> <code class="applescript color2">=</code> <code class="applescript string">"敌人数量:"</code> <code class="applescript color2">+</code> <code class="applescript plain">enemySpawn.EnemyCount;</code></div><div class="line number14 index14 alt1"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
</font>

> <font face="微软雅黑"><font size="3">我们利用Monobehavior轻车熟路地实现了我们的游戏。</font></font>

> <font face="微软雅黑"><font size="3"><br>
> </font></font>

<font face="微软雅黑"><font size="3">运行游戏：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑"><font size="3">
<ignore_js_op>

<img id="aimg_171250" aid="171250" src="http://img.manew.com/data/attachment/forum/201812/07/150037i2vsyem6026890m6.gif" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150037i2vsyem6026890m6.gif" file="http://img.manew.com/data/attachment/forum/201812/07/150037i2vsyem6026890m6.gif" class="zoom" onclick="zoom(this, this.src, 0, 0, 0)" width="594" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1" initialized="true" style="">

<div class="tip tip_4 aimg_tip" id="aimg_171250_menu" style="position: absolute; z-index: 301; left: 504.625px; top: 7061px; display: none;" disautofocus="true" initialized="true">
<div class="xs0">
<p><strong>1.2.gif</strong> <em class="xg1">(1.69 MB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjUwfGJlZTc3MjdjfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171250" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171250&amp;handlekey=savephoto_171250">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:00">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font></font>

<font face="微软雅黑"><br>
<br>
<font size="3">以为这就结束了吗？</font><br>
<font size="3"><br>
</font><br>
</font>

---

<font face="微软雅黑"><font size="3"><strong>下面的才是重点加难点。</strong></font><br>
<br>
<br>
<font size="3">我们使用<strong>Entities</strong>实现同样的功能，最后进行性能上的比较。</font><br>
<font size="3">在开始前确保安装上了<strong>Entities</strong>，在菜单栏Window-&gt;Package Manager-&gt;All可以找到，如果网络出现<a href="http://www.manew.com/forum-ask-1.html" target="_blank" class="relatedlink">问题</a>可以反复尝试几次。</font><br>
<font size="3">首先我们需要想清楚<strong>Component</strong>与<strong>System</strong>的关系再开始编写代码。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<font size="3">我们的游戏有三个关键的实体：玩家，敌人，摄像机</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<font size="3">这里画一张图方便大家理解，从上往下依次是：实体，系统，组件，系统。他们的关系通过连线一目了然。</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171252" aid="171252" src="http://img.manew.com/data/attachment/forum/201812/07/150108w1646t4u06nt8tj4.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150108w1646t4u06nt8tj4.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150108w1646t4u06nt8tj4.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1" initialized="true">

<div class="tip tip_4 aimg_tip" id="aimg_171252_menu" style="position: absolute; z-index: 301; left: 601.625px; top: 8073px; display: none;" disautofocus="true" initialized="true">
<div class="xs0">
<p><strong>7.jpg</strong> <em class="xg1">(64.05 KB, 下载次数: 1)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjUyfDU2ODc1YmY1fDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171252" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171252&amp;handlekey=savephoto_171252">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:01">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑" class="__reader_view_article_wrap_4271373029909895__"><br>
<br>
<br>
<font size="3">看上去有点复杂，总的思想就是不同系统需要关注不同的组件并进行相应的操作。</font><font size="3"><br>
</font><font size="3">提高性能的关键在于脚本的并行，我们看看那些系统应该实现并行：EnemyCollisionSystem，EnemyMoveSystem，这两个系统因为是关键系统并且不存在逻辑与引用的依赖所以可以实现并行。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<font size="3">首先我们创建一个新的场景，<strong>Camera</strong>的设置需要从第一个场景中Copy过来使用。</font><br>
<font size="3"><br>
</font><br>
<font size="3">然后我们再场景中创建一个空物体代表<strong>Player</strong>（Tag选择Player），并且挂上一个组件：</font><br>
<font size="3"><br>
</font><br>
<div align="center"><div style="width: 340px; height: 1px;background: url(static/image/common/loading.gif) no-repeat center center;"></div><img id="aimg_vy2IU" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" width="340" height="1" file="https://pic3.zhimg.com/80/v2-50965d958225367b20d97f9901726462_hd.jpg" border="0" alt="" src="https://pic3.zhimg.com/80/v2-50965d958225367b20d97f9901726462_hd.jpg" lazyloaded="true" style="height: 1px; width: 1px;"></div><br>
<br>
<font size="3">我们在Mesh一栏中选择Sphere圆球，然后选择之前创建的对应的材质。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><strong>Enemy</strong>也是一样，只需要在Material一栏中选择不同的材质就好了。</font><br>
<font size="3"><br>
</font><br>
<font size="3">UI也可以从之前的场景中复制过来：</font><br>
<font size="3"><br>
</font><br>
<div align="center">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171253" aid="171253" src="http://img.manew.com/data/attachment/forum/201812/07/150143dc8ns2hmtvl3fuvs.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150143dc8ns2hmtvl3fuvs.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150143dc8ns2hmtvl3fuvs.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171253_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>8.jpg</strong> <em class="xg1">(8.52 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjUzfGI5ZWZjYmMzfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171253" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171253&amp;handlekey=savephoto_171253">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:01">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<font size="3"><br>
</font><font size="3">第一步，我们照着图来编写好我们的组件，首先创建一个名为<strong>Bootstrap</strong>的脚本，为了方便起见我们就把所有的类都放在一个文件中进行管理：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="5">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="5">复制代码</em></div><div><div id="highlighter_386513" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">namespace MultiThread</code></div><div class="line number1 index1 alt2"><code class="applescript color1">{</code></div><div class="line number2 index2 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine;</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">UnityEngine.UI;</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Entities;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Jobs;</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Burst;</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Rendering;</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Transforms;</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Mathematics;</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Unity.Collections;</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">using</code> <code class="applescript plain">Random </code><code class="applescript color2">=</code> <code class="applescript plain">UnityEngine.Random;</code></div><div class="line number12 index12 alt1">&nbsp;</div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public struct PlayerInput </code><code class="applescript color1">:</code> <code class="applescript plain">IComponentData</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float</code><code class="applescript color1">3</code> <code class="applescript plain">Vector;</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number17 index17 alt2">&nbsp;</div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public struct EnemyComponent </code><code class="applescript color1">:</code> <code class="applescript plain">IComponentData</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number21 index21 alt2">&nbsp;</div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public struct CameraComponent </code><code class="applescript color1">:</code> <code class="applescript plain">IComponentData</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number25 index25 alt2">&nbsp;</div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public struct Health </code><code class="applescript color1">:</code> <code class="applescript plain">IComponentData</code></div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number28 index28 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public int Value;</code></div><div class="line number29 index29 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number30 index30 alt1">&nbsp;</div><div class="line number31 index31 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public struct Velocity </code><code class="applescript color1">:</code> <code class="applescript plain">IComponentData</code></div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float Value;</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number35 index35 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><font size="3"><br>
</font><br>
</font>

> <font face="微软雅黑"><font size="3">值得注意的是Unity ECS里面有一个bug导致不能在结构中声明bool类型。</font></font>

<font face="微软雅黑"><font size="3">以上的组件属于自定义组件，除此之外还有三个Unity提供的组件：</font><br>
<font size="3"><br>
</font><br>
<strong><font size="3">Position，MeshInstanceRenderer，Transform</font></strong><br>
<strong><font size="3"><br>
</font></strong><br>
<strong><font size="3"><br>
</font></strong><br>
<font size="3">然后我们创建一个Bootstrap类，在其中创建一个能用被Unity自动调用的方法：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="6">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="6">复制代码</em></div><div><div id="highlighter_565551" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">1</div><div class="line number2 index2 alt1">2</div><div class="line number3 index3 alt2">3</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">[RuntimeInitializeOnLoadMethod</code><code class="applescript color1">(</code><code class="applescript plain">RuntimeInitializeLoadType.AfterSceneLoad</code><code class="applescript color1">)</code><code class="applescript plain">]</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public static void Start</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">再Start方法中创建EntityManager开始，并进行初始化操作。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="7">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="7">复制代码</em></div><div><div id="highlighter_217892" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">EntityManager manager </code><code class="applescript color2">=</code> <code class="applescript plain">World.Active.GetOrCreateManager</code><code class="applescript color2">&lt;</code><code class="applescript plain">EntityManager</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number1 index1 alt2">&nbsp;</div><div class="line number2 index2 alt1"><code class="applescript plain">GameObject player </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.FindWithTag</code><code class="applescript color1">(</code><code class="applescript string">"Player"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number3 index3 alt2"><code class="applescript plain">GameObject enemy </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.FindWithTag</code><code class="applescript color1">(</code><code class="applescript string">"Enemy"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number4 index4 alt1"><code class="applescript plain">GameObject camera </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.FindWithTag</code><code class="applescript color1">(</code><code class="applescript string">"MainCamera"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number5 index5 alt2"><code class="applescript plain">Text enemyCount </code><code class="applescript color2">=</code> <code class="applescript plain">GameObject.Find</code><code class="applescript color1">(</code><code class="applescript string">"EnemyCountText"</code><code class="applescript color1">)</code><code class="applescript plain">.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">Text</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number6 index6 alt1">&nbsp;</div><div class="line number7 index7 alt2"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">获取Player MeshInstanceRenderer</code></div><div class="line number8 index8 alt1"><code class="applescript plain">MeshInstanceRenderer playerRenderer </code><code class="applescript color2">=</code> <code class="applescript plain">player.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">MeshInstanceRendererComponent</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">.Value;</code></div><div class="line number9 index9 alt2"><code class="applescript plain">Object.Destroy</code><code class="applescript color1">(</code><code class="applescript plain">player</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number10 index10 alt1"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">获取Enemy MeshInstanceRenderer</code></div><div class="line number11 index11 alt2"><code class="applescript plain">MeshInstanceRenderer enemyRenderer </code><code class="applescript color2">=</code> <code class="applescript plain">enemy.GetComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">MeshInstanceRendererComponent</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">.Value;</code></div><div class="line number12 index12 alt1"><code class="applescript plain">Object.Destroy</code><code class="applescript color1">(</code><code class="applescript plain">enemy</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number13 index13 alt2"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">初始化玩家实体</code></div><div class="line number14 index14 alt1"><code class="applescript plain">Entity entity </code><code class="applescript color2">=</code> <code class="applescript plain">manager.CreateEntity</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number15 index15 alt2"><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">PlayerInput </code><code class="applescript color1">{</code> <code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number16 index16 alt1"><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">Position </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">float</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript color1">0</code><code class="applescript color1">,</code> <code class="applescript color1">0</code><code class="applescript color1">,</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number17 index17 alt2"><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">Velocity </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript color1">7</code> <code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number18 index18 alt1"><code class="applescript plain">manager.AddSharedComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript plain">playerRenderer</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number19 index19 alt2"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">初始化摄像机实体</code></div><div class="line number20 index20 alt1"><code class="applescript plain">GameObjectEntity gameObjectEntity </code><code class="applescript color2">=</code> <code class="applescript plain">camera.AddComponent</code><code class="applescript color2">&lt;</code><code class="applescript plain">GameObjectEntity</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number21 index21 alt2"><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">gameObjectEntity.Entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">CameraComponent</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">上面代码比较简单不做过多讲解。</font><br>
<font size="3"><br>
</font><br>
<font size="3">创建第一个系统<strong>PlayerInputSystem</strong>，照着上面的设计图纸，关注相应的组件并进行操作就好了。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="8">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="8">复制代码</em></div><div><div id="highlighter_926439" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">PlayerInputSystem </code><code class="applescript color1">:</code> <code class="applescript plain">ComponentSystem</code></div><div class="line number1 index1 alt2"><code class="applescript color1">{</code></div><div class="line number2 index2 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Player</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">PlayerInput</code><code class="applescript color2">&gt;</code> <code class="applescript plain">playerInput;</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number7 index7 alt2">&nbsp;</div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Player player; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">加上这个标签，Unity会自动注入我们声明的结构中的属性</code></div><div class="line number9 index9 alt2">&nbsp;</div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnUpdate</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">for</code> <code class="applescript color1">(</code><code class="applescript plain">int i </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">; i </code><code class="applescript color2">&lt;</code> <code class="applescript plain">player.Length; i</code><code class="applescript color2">+</code><code class="applescript color2">+</code><code class="applescript color1">)</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">normalized </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">float</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float x </code><code class="applescript color2">=</code> <code class="applescript plain">Input.GetAxisRaw</code><code class="applescript color1">(</code><code class="applescript string">"Horizontal"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float y </code><code class="applescript color2">=</code> <code class="applescript plain">Input.GetAxisRaw</code><code class="applescript color1">(</code><code class="applescript string">"Vertical"</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">x !</code><code class="applescript color2">=</code> <code class="applescript color1">0</code> <code class="applescript plain">|| y !</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">注意：直接归一化</code><code class="applescript color1">0</code><code class="applescript plain">向量会导致bug</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">normalized </code><code class="applescript color2">=</code> <code class="applescript plain">math.normalize</code><code class="applescript color1">(</code><code class="applescript color3">new</code> <code class="applescript plain">float</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">x</code><code class="applescript color1">,</code> <code class="applescript plain">y</code><code class="applescript color1">,</code> <code class="applescript color1">0</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">player.playerInput </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">PlayerInput </code><code class="applescript color1">{</code> <code class="applescript plain">Vector </code><code class="applescript color2">=</code> <code class="applescript plain">normalized </code><code class="applescript color1">}</code><code class="applescript plain">;</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number22 index22 alt1"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font></font>

<font face="微软雅黑"><font size="3"><br>
</font><br>
</font>

> <font face="微软雅黑"><font size="3">以上的操作在上一篇ECS文章中有提及。</font></font>

> <font face="微软雅黑"><font size="3"><br>
> </font></font>

<font face="微软雅黑"><font size="3"><strong>PlayerMoveSystem</strong>应该关注相应的组件并且进行相应的操作：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="9">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="9">复制代码</em></div><div><div id="highlighter_302921" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">PlayerMoveSystem </code><code class="applescript color1">:</code> <code class="applescript plain">ComponentSystem</code></div><div class="line number1 index1 alt2"><code class="applescript color1">{</code></div><div class="line number2 index2 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Player</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code> <code class="applescript plain">positions;</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">PlayerInput</code><code class="applescript color2">&gt;</code> <code class="applescript plain">playerInput;</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Velocity</code><code class="applescript color2">&gt;</code> <code class="applescript plain">velocities;</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number9 index9 alt2">&nbsp;</div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Player player;</code></div><div class="line number11 index11 alt2">&nbsp;</div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnUpdate</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float deltaTime </code><code class="applescript color2">=</code> <code class="applescript plain">Time.deltaTime;</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">for</code> <code class="applescript color1">(</code><code class="applescript plain">int i </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">; i </code><code class="applescript color2">&lt;</code> <code class="applescript plain">player.Length; i</code><code class="applescript color2">+</code><code class="applescript color2">+</code><code class="applescript color1">)</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">Read</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Position </code><code class="applescript color3">position</code> <code class="applescript color2">=</code> <code class="applescript plain">player.positions;</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">PlayerInput input </code><code class="applescript color2">=</code> <code class="applescript plain">player.playerInput;</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Velocity velocity </code><code class="applescript color2">=</code> <code class="applescript plain">player.velocities;</code></div><div class="line number21 index21 alt2">&nbsp;</div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">position</code><code class="applescript plain">.Value </code><code class="applescript color2">+</code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">float</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">input.Vector </code><code class="applescript color2">*</code> <code class="applescript plain">velocity.Value </code><code class="applescript color2">*</code> <code class="applescript plain">deltaTime</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">Write</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">player.positions </code><code class="applescript color2">=</code> <code class="applescript color3">position</code><code class="applescript plain">;</code></div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number27 index27 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font></font>_<font face="微软雅黑"><font size="3"><br>
</font><br>
<font size="3">现在我们就已经可以控制我们的玩家小球移动了，趁热打铁继续深入。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><strong>CameraMoveSystem</strong>与上面的系统在实现上不会有太大差别。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="10">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="10">复制代码</em></div><div><div id="highlighter_475576" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">[UpdateAfter</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">PlayerMoveSystem</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript plain">] </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">存在依赖关系</code><code class="applescript color1">,</code> <code class="applescript plain">我们控制该系统的更新在PlayerMoveSystem之后</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">CameraMoveSystem </code><code class="applescript color1">:</code> <code class="applescript plain">ComponentSystem</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Player</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">PlayerInput</code><code class="applescript color2">&gt;</code> <code class="applescript plain">playerInputs;</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code> <code class="applescript plain">positions;</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Cam</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">CameraComponent</code><code class="applescript color2">&gt;</code> <code class="applescript plain">cameras;</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Transform</code><code class="applescript color2">&gt;</code> <code class="applescript plain">transforms;</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Player player;</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Cam cam;</code></div><div class="line number16 index16 alt1">&nbsp;</div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnUpdate</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">player.Length </code><code class="applescript color2">=</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">玩家死亡</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code><code class="applescript plain">;</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">pos </code><code class="applescript color2">=</code> <code class="applescript plain">player.positions[</code><code class="applescript color1">0</code><code class="applescript plain">].Value;</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">相机跟随</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">cam.transforms[</code><code class="applescript color1">0</code><code class="applescript plain">].</code><code class="applescript color3">position</code> <code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">Vector</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">pos.x</code><code class="applescript color1">,</code> <code class="applescript plain">pos.y</code><code class="applescript color1">,</code> <code class="applescript plain">cam.transforms[</code><code class="applescript color1">0</code><code class="applescript plain">].</code><code class="applescript color3">position</code><code class="applescript plain">.z</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number25 index25 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">UI系统还算比较好理解的，不做阐述细节了：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="11">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="11">复制代码</em></div><div><div id="highlighter_394057" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">[AlwaysUpdateSystem] </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">持续更新系统</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">UISystem </code><code class="applescript color1">:</code> <code class="applescript plain">ComponentSystem</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Text enemyCount;</code></div><div class="line number4 index4 alt1">&nbsp;</div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Init</code><code class="applescript color1">(</code><code class="applescript plain">Text enemyCount</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">&gt;</code> <code class="applescript plain">this.enemyCount </code><code class="applescript color2">=</code> <code class="applescript plain">enemyCount;</code></div><div class="line number6 index6 alt1">&nbsp;</div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Player</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">PlayerInput</code><code class="applescript color2">&gt;</code> <code class="applescript plain">playerInputs;</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Enemy</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">EnemyComponent</code><code class="applescript color2">&gt;</code> <code class="applescript plain">enemies;</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Player player;</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Enemy enemy;</code></div><div class="line number19 index19 alt2">&nbsp;</div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnUpdate</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">player.Length </code><code class="applescript color2">=</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">玩家死亡</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code><code class="applescript plain">;</code></div><div class="line number24 index24 alt1">&nbsp;</div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemyCount.</code><code class="applescript color3">text</code> <code class="applescript color2">=</code> <code class="applescript string">"敌人数量:"</code> <code class="applescript color2">+</code> <code class="applescript plain">enemy.Length;</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number27 index27 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">敌人生成系统中使用了一个生成的小算法，以玩家为原点在圆球的周长上随机一个点生成敌人</font><br>
<font size="3"><br>
</font><br>
<div align="center">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171254" aid="171254" src="http://img.manew.com/data/attachment/forum/201812/07/150355q2a48dhph2ok0peg.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150355q2a48dhph2ok0peg.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150355q2a48dhph2ok0peg.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171254_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>9.jpg</strong> <em class="xg1">(6.9 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjU0fDNkMTdkZjgyfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171254" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171254&amp;handlekey=savephoto_171254">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:03">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="12">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="12">复制代码</em></div><div><div id="highlighter_33416" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div><div class="line number36 index36 alt1">36</div><div class="line number37 index37 alt2">37</div><div class="line number38 index38 alt1">38</div><div class="line number39 index39 alt2">39</div><div class="line number40 index40 alt1">40</div><div class="line number41 index41 alt2">41</div><div class="line number42 index42 alt1">42</div><div class="line number43 index43 alt2">43</div><div class="line number44 index44 alt1">44</div><div class="line number45 index45 alt2">45</div><div class="line number46 index46 alt1">46</div><div class="line number47 index47 alt2">47</div><div class="line number48 index48 alt1">48</div><div class="line number49 index49 alt2">49</div><div class="line number50 index50 alt1">50</div><div class="line number51 index51 alt2">51</div><div class="line number52 index52 alt1">52</div><div class="line number53 index53 alt2">53</div><div class="line number54 index54 alt1">54</div><div class="line number55 index55 alt2">55</div><div class="line number56 index56 alt1">56</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">EnemySpawnSystem </code><code class="applescript color1">:</code> <code class="applescript plain">ComponentSystem</code></div><div class="line number1 index1 alt2"><code class="applescript color1">{</code></div><div class="line number2 index2 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">EntityManager manager;</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">MeshInstanceRenderer enemyLook;</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float timer;</code></div><div class="line number5 index5 alt2">&nbsp;</div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Init</code><code class="applescript color1">(</code><code class="applescript plain">EntityManager manager</code><code class="applescript color1">,</code> <code class="applescript plain">MeshInstanceRenderer enemyLook</code><code class="applescript color1">)</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.manager </code><code class="applescript color2">=</code> <code class="applescript plain">manager;</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.enemyLook </code><code class="applescript color2">=</code> <code class="applescript plain">enemyLook;</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">timer </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">;</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number12 index12 alt1">&nbsp;</div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Player</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">PlayerInput</code><code class="applescript color2">&gt;</code> <code class="applescript plain">playerInputs;</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code> <code class="applescript plain">positions;</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number19 index19 alt2">&nbsp;</div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Player player;</code></div><div class="line number21 index21 alt2">&nbsp;</div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnUpdate</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">timer </code><code class="applescript color2">+</code><code class="applescript color2">=</code> <code class="applescript plain">Time.deltaTime;</code></div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">timer </code><code class="applescript color2">&gt;</code><code class="applescript color2">=</code> <code class="applescript color1">0.1</code><code class="applescript plain">f</code><code class="applescript color1">)</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">timer </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">;</code></div><div class="line number28 index28 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">CreatEnemy</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number29 index29 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number30 index30 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number31 index31 alt2">&nbsp;</div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">void CreatEnemy</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">player.Length </code><code class="applescript color2">=</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">玩家死亡</code></div><div class="line number35 index35 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code><code class="applescript plain">;</code></div><div class="line number36 index36 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">playerPos </code><code class="applescript color2">=</code> <code class="applescript plain">player.positions[</code><code class="applescript color1">0</code><code class="applescript plain">].Value;</code></div><div class="line number37 index37 alt2">&nbsp;</div><div class="line number38 index38 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">for</code> <code class="applescript color1">(</code><code class="applescript plain">int i </code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">; i </code><code class="applescript color2">&lt;</code> <code class="applescript color1">50</code><code class="applescript plain">; i</code><code class="applescript color2">+</code><code class="applescript color2">+</code><code class="applescript color1">)</code></div><div class="line number39 index39 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number40 index40 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Entity entity </code><code class="applescript color2">=</code> <code class="applescript plain">manager.CreateEntity</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number41 index41 alt2">&nbsp;</div><div class="line number42 index42 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">int angle </code><code class="applescript color2">=</code> <code class="applescript plain">Random.Range</code><code class="applescript color1">(</code><code class="applescript color1">1</code><code class="applescript color1">,</code> <code class="applescript color1">360</code><code class="applescript color1">)</code><code class="applescript plain">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">在玩家什么角度刷出来</code></div><div class="line number43 index43 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float distance </code><code class="applescript color2">=</code> <code class="applescript plain">Random.Range</code><code class="applescript color1">(</code><code class="applescript color1">15</code><code class="applescript plain">f</code><code class="applescript color1">,</code> <code class="applescript color1">25</code><code class="applescript plain">f</code><code class="applescript color1">)</code><code class="applescript plain">; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">距离玩家多远刷出来</code></div><div class="line number44 index44 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">计算该点的x</code><code class="applescript color1">,</code> <code class="applescript plain">y分量</code></div><div class="line number45 index45 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float y </code><code class="applescript color2">=</code> <code class="applescript plain">Mathf.Sin</code><code class="applescript color1">(</code><code class="applescript plain">angle</code><code class="applescript color1">)</code> <code class="applescript color2">*</code> <code class="applescript plain">distance;</code></div><div class="line number46 index46 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float x </code><code class="applescript color2">=</code> <code class="applescript plain">y </code><code class="applescript color2">/</code> <code class="applescript plain">Mathf.Tan</code><code class="applescript color1">(</code><code class="applescript plain">angle</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number47 index47 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">positon </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">float</code><code class="applescript color1">3</code><code class="applescript color1">(</code><code class="applescript plain">playerPos.x </code><code class="applescript color2">+</code> <code class="applescript plain">x</code><code class="applescript color1">,</code> <code class="applescript plain">playerPos.y </code><code class="applescript color2">+</code> <code class="applescript plain">y</code><code class="applescript color1">,</code> <code class="applescript color1">0</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number48 index48 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">初始化敌人及属性</code></div><div class="line number49 index49 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">EnemyComponent </code><code class="applescript color1">{</code> <code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number50 index50 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">Health </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript color1">1</code> <code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number51 index51 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">Position </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript plain">positon </code><code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number52 index52 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">manager.AddComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript color3">new</code> <code class="applescript plain">Velocity </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript color1">1</code> <code class="applescript color1">}</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number53 index53 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">manager.AddSharedComponentData</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">,</code> <code class="applescript plain">enemyLook</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number54 index54 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number55 index55 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number56 index56 alt1"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">到这里我们已经实现了玩家的输入，移动，摄像机跟随，UI，与敌人生成。还没完，最关键的并行系统：EnemyMove跟EnemyCollision还没有实现。</font><br>
<font size="3">难点中的难点来了，<strong>EnemyMoveSystem</strong>需要继承<strong>JobComponent</strong>系统来实现并行。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="13">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="13">复制代码</em></div><div><div id="highlighter_106377" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div><div class="line number36 index36 alt1">36</div><div class="line number37 index37 alt2">37</div><div class="line number38 index38 alt1">38</div><div class="line number39 index39 alt2">39</div><div class="line number40 index40 alt1">40</div><div class="line number41 index41 alt2">41</div><div class="line number42 index42 alt1">42</div><div class="line number43 index43 alt2">43</div><div class="line number44 index44 alt1">44</div><div class="line number45 index45 alt2">45</div><div class="line number46 index46 alt1">46</div><div class="line number47 index47 alt2">47</div><div class="line number48 index48 alt1">48</div><div class="line number49 index49 alt2">49</div><div class="line number50 index50 alt1">50</div><div class="line number51 index51 alt2">51</div><div class="line number52 index52 alt1">52</div><div class="line number53 index53 alt2">53</div><div class="line number54 index54 alt1">54</div><div class="line number55 index55 alt2">55</div><div class="line number56 index56 alt1">56</div><div class="line number57 index57 alt2">57</div><div class="line number58 index58 alt1">58</div><div class="line number59 index59 alt2">59</div><div class="line number60 index60 alt1">60</div><div class="line number61 index61 alt2">61</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">EnemyMoveSystem </code><code class="applescript color1">:</code> <code class="applescript plain">JobComponentSystem</code></div><div class="line number1 index1 alt2"><code class="applescript color1">{</code></div><div class="line number2 index2 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentGroup enemyGroup;&nbsp;&nbsp; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">由一系列组件组成</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentGroup playerGroup;</code></div><div class="line number4 index4 alt1">&nbsp;</div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnCreateManager</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">系统创建时调用</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">声明该组所需的组件，包括读写依赖</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemyGroup </code><code class="applescript color2">=</code> <code class="applescript plain">GetComponentGroup</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">(</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">Velocity</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">EnemyComponent</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">Position</code><code class="applescript color1">)</code></div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">playerGroup </code><code class="applescript color2">=</code> <code class="applescript plain">GetComponentGroup</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">(</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">PlayerInput</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">Position</code><code class="applescript color1">)</code><code class="applescript color1">)</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number20 index20 alt1">&nbsp;</div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[BurstCompile] </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">使用Burst编译</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct EnemyMoveJob </code><code class="applescript color1">:</code> <code class="applescript plain">IJobParallelFor </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">继承该接口实现并行</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float deltaTime;</code></div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float</code><code class="applescript color1">3</code> <code class="applescript plain">playerPos;</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">记得声明读写关系</code></div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code> <code class="applescript plain">positions;</code></div><div class="line number28 index28 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[ReadOnly] public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Velocity</code><code class="applescript color2">&gt;</code> <code class="applescript plain">velocities;</code></div><div class="line number29 index29 alt2">&nbsp;</div><div class="line number30 index30 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Execute</code><code class="applescript color1">(</code><code class="applescript plain">int i</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">会被不同的线程调用，所以方法中不能存在引用类型。</code></div><div class="line number31 index31 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">Read</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript color3">position</code> <code class="applescript color2">=</code> <code class="applescript plain">positions.Value;</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float speed </code><code class="applescript color2">=</code> <code class="applescript plain">velocities.Value;</code></div><div class="line number35 index35 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">算出朝向玩家的向量</code></div><div class="line number36 index36 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">vector </code><code class="applescript color2">=</code> <code class="applescript plain">playerPos </code><code class="applescript color2">-</code> <code class="applescript color3">position</code><code class="applescript plain">;</code></div><div class="line number37 index37 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">vector </code><code class="applescript color2">=</code> <code class="applescript plain">math.normalize</code><code class="applescript color1">(</code><code class="applescript plain">vector</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number38 index38 alt1">&nbsp;</div><div class="line number39 index39 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">newPos </code><code class="applescript color2">=</code> <code class="applescript color3">position</code> <code class="applescript color2">+</code> <code class="applescript plain">vector </code><code class="applescript color2">*</code> <code class="applescript plain">speed </code><code class="applescript color2">*</code> <code class="applescript plain">deltaTime;</code></div><div class="line number40 index40 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">Wirte</code></div><div class="line number41 index41 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">positions </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">Position </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript plain">newPos </code><code class="applescript color1">}</code><code class="applescript plain">;</code></div><div class="line number42 index42 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number43 index43 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number44 index44 alt1">&nbsp;</div><div class="line number45 index45 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override JobHandle OnUpdate</code><code class="applescript color1">(</code><code class="applescript plain">JobHandle inputDeps</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">每帧调用</code></div><div class="line number46 index46 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number47 index47 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">playerGroup.CalculateLength</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">玩家死亡</code></div><div class="line number48 index48 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">return</code> <code class="applescript plain">base.OnUpdate</code><code class="applescript color1">(</code><code class="applescript plain">inputDeps</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number49 index49 alt2">&nbsp;</div><div class="line number50 index50 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">playerPos </code><code class="applescript color2">=</code> <code class="applescript plain">playerGroup.GetComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">[</code><code class="applescript color1">0</code><code class="applescript plain">].Value;</code></div><div class="line number51 index51 alt2">&nbsp;</div><div class="line number52 index52 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">EnemyMoveJob job </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">EnemyMoveJob</code></div><div class="line number53 index53 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number54 index54 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">deltaTime </code><code class="applescript color2">=</code> <code class="applescript plain">Time.deltaTime</code><code class="applescript color1">,</code></div><div class="line number55 index55 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">playerPos </code><code class="applescript color2">=</code> <code class="applescript plain">playerPos</code><code class="applescript color1">,</code></div><div class="line number56 index56 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">positions </code><code class="applescript color2">=</code> <code class="applescript plain">enemyGroup.GetComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript color1">,</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">声明了组件后，Get时会进行组件的获取</code></div><div class="line number57 index57 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">velocities </code><code class="applescript color2">=</code> <code class="applescript plain">enemyGroup.GetComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Velocity</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number58 index58 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code><code class="applescript plain">;</code></div><div class="line number59 index59 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code> <code class="applescript plain">job.Schedule</code><code class="applescript color1">(</code><code class="applescript plain">enemyGroup.CalculateLength</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript color1">,</code> <code class="applescript color1">64</code><code class="applescript color1">,</code> <code class="applescript plain">inputDeps</code><code class="applescript color1">)</code><code class="applescript plain">; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">第一个参数意味着每个job.Execute的执行次数</code></div><div class="line number60 index60 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number61 index61 alt2"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font></font>

<font face="微软雅黑"><br>
<font size="3">上面这个系统比较复杂但却是Unity ECS的核心，特别是OnUpdate中进行的操作，返回的JobHandle会被不同线程执行，理解这一点是关键。</font><br>
<font size="3">EnemyCollisionSystem在实现上几乎与上述系统一致：</font><br>
</font>

<font face="微软雅黑"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="14">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="14">复制代码</em></div><div><div id="highlighter_737185" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div><div class="line number36 index36 alt1">36</div><div class="line number37 index37 alt2">37</div><div class="line number38 index38 alt1">38</div><div class="line number39 index39 alt2">39</div><div class="line number40 index40 alt1">40</div><div class="line number41 index41 alt2">41</div><div class="line number42 index42 alt1">42</div><div class="line number43 index43 alt2">43</div><div class="line number44 index44 alt1">44</div><div class="line number45 index45 alt2">45</div><div class="line number46 index46 alt1">46</div><div class="line number47 index47 alt2">47</div><div class="line number48 index48 alt1">48</div><div class="line number49 index49 alt2">49</div><div class="line number50 index50 alt1">50</div><div class="line number51 index51 alt2">51</div><div class="line number52 index52 alt1">52</div><div class="line number53 index53 alt2">53</div><div class="line number54 index54 alt1">54</div><div class="line number55 index55 alt2">55</div><div class="line number56 index56 alt1">56</div><div class="line number57 index57 alt2">57</div><div class="line number58 index58 alt1">58</div><div class="line number59 index59 alt2">59</div><div class="line number60 index60 alt1">60</div><div class="line number61 index61 alt2">61</div><div class="line number62 index62 alt1">62</div><div class="line number63 index63 alt2">63</div><div class="line number64 index64 alt1">64</div><div class="line number65 index65 alt2">65</div><div class="line number66 index66 alt1">66</div><div class="line number67 index67 alt2">67</div><div class="line number68 index68 alt1">68</div><div class="line number69 index69 alt2">69</div><div class="line number70 index70 alt1">70</div><div class="line number71 index71 alt2">71</div><div class="line number72 index72 alt1">72</div><div class="line number73 index73 alt2">73</div><div class="line number74 index74 alt1">74</div><div class="line number75 index75 alt2">75</div><div class="line number76 index76 alt1">76</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">[UpdateAfter</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">PlayerMoveSystem</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript plain">] </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">逻辑上依赖于玩家移动系统，所以声明更新时序</code></div><div class="line number1 index1 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">EnemyCollisionSystem </code><code class="applescript color1">:</code> <code class="applescript plain">JobComponentSystem</code></div><div class="line number2 index2 alt1"><code class="applescript color1">{</code></div><div class="line number3 index3 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float playerRadius;</code></div><div class="line number4 index4 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float enemyRadius;</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Init</code><code class="applescript color1">(</code><code class="applescript plain">float playerRadius</code><code class="applescript color1">,</code> <code class="applescript plain">float enemyRadius</code><code class="applescript color1">)</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.playerRadius </code><code class="applescript color2">=</code> <code class="applescript plain">playerRadius;</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">this.enemyRadius </code><code class="applescript color2">=</code> <code class="applescript plain">enemyRadius;</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number10 index10 alt1">&nbsp;</div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentGroup enemyGroup;</code></div><div class="line number12 index12 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentGroup playerGroup;</code></div><div class="line number13 index13 alt2">&nbsp;</div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override void OnCreateManager</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemyGroup </code><code class="applescript color2">=</code> <code class="applescript plain">GetComponentGroup</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">(</code></div><div class="line number18 index18 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">EnemyComponent</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">Health</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">Position</code><code class="applescript color1">)</code><code class="applescript color1">)</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">playerGroup </code><code class="applescript color2">=</code> <code class="applescript plain">GetComponentGroup</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">(</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">PlayerInput</code><code class="applescript color1">)</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">ComponentType.ReadOnly</code><code class="applescript color1">(</code><code class="applescript plain">typeof</code><code class="applescript color1">(</code><code class="applescript plain">Position</code><code class="applescript color1">)</code><code class="applescript color1">)</code></div><div class="line number26 index26 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number28 index28 alt1">&nbsp;</div><div class="line number29 index29 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[BurstCompile]</code></div><div class="line number30 index30 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct EnemyCollisionJob </code><code class="applescript color1">:</code> <code class="applescript plain">IJobParallelFor</code></div><div class="line number31 index31 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public int collisionDamage; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">碰撞对双方造成的伤害</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float playerRadius;</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float enemyRadius;</code></div><div class="line number35 index35 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public float</code><code class="applescript color1">3</code> <code class="applescript plain">playerPos;</code></div><div class="line number36 index36 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[ReadOnly] public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code> <code class="applescript plain">positions;</code></div><div class="line number37 index37 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Health</code><code class="applescript color2">&gt;</code> <code class="applescript plain">enemies;</code></div><div class="line number38 index38 alt1">&nbsp;</div><div class="line number39 index39 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Execute</code><code class="applescript color1">(</code><code class="applescript plain">int i</code><code class="applescript color1">)</code></div><div class="line number40 index40 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number41 index41 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript color3">position</code> <code class="applescript color2">=</code> <code class="applescript plain">positions[i].Value;</code></div><div class="line number42 index42 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float x </code><code class="applescript color2">=</code> <code class="applescript plain">math.abs</code><code class="applescript color1">(</code><code class="applescript color3">position</code><code class="applescript plain">.x </code><code class="applescript color2">-</code> <code class="applescript plain">playerPos.x</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number43 index43 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float y </code><code class="applescript color2">=</code> <code class="applescript plain">math.abs</code><code class="applescript color1">(</code><code class="applescript color3">position</code><code class="applescript plain">.y </code><code class="applescript color2">-</code> <code class="applescript plain">playerPos.y</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number44 index44 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">距离</code></div><div class="line number45 index45 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float magnitude </code><code class="applescript color2">=</code> <code class="applescript plain">math.sqrt</code><code class="applescript color1">(</code><code class="applescript plain">x </code><code class="applescript color2">*</code> <code class="applescript plain">x </code><code class="applescript color2">+</code> <code class="applescript plain">y </code><code class="applescript color2">*</code> <code class="applescript plain">y</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number46 index46 alt1">&nbsp;</div><div class="line number47 index47 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">圆形碰撞检测</code></div><div class="line number48 index48 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">magnitude </code><code class="applescript color2">&lt;</code> <code class="applescript plain">playerRadius </code><code class="applescript color2">+</code> <code class="applescript plain">enemyRadius</code><code class="applescript color1">)</code></div><div class="line number49 index49 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number50 index50 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">Read</code></div><div class="line number51 index51 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">int health </code><code class="applescript color2">=</code> <code class="applescript plain">enemies[i].Value;</code></div><div class="line number52 index52 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">Write</code></div><div class="line number53 index53 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemies[i] </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">Health </code><code class="applescript color1">{</code> <code class="applescript plain">Value </code><code class="applescript color2">=</code> <code class="applescript plain">health </code><code class="applescript color2">-</code> <code class="applescript plain">collisionDamage </code><code class="applescript color1">}</code><code class="applescript plain">;</code></div><div class="line number54 index54 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number55 index55 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number56 index56 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number57 index57 alt2">&nbsp;</div><div class="line number58 index58 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override JobHandle OnUpdate</code><code class="applescript color1">(</code><code class="applescript plain">JobHandle inputDeps</code><code class="applescript color1">)</code></div><div class="line number59 index59 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number60 index60 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">playerGroup.CalculateLength</code><code class="applescript color1">(</code><code class="applescript color1">)</code> <code class="applescript color2">=</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript color1">)</code> <code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">玩家死亡</code></div><div class="line number61 index61 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color3">return</code> <code class="applescript plain">base.OnUpdate</code><code class="applescript color1">(</code><code class="applescript plain">inputDeps</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number62 index62 alt1">&nbsp;</div><div class="line number63 index63 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">float</code><code class="applescript color1">3</code> <code class="applescript plain">playerPos </code><code class="applescript color2">=</code> <code class="applescript plain">playerGroup.GetComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">[</code><code class="applescript color1">0</code><code class="applescript plain">].Value;</code></div><div class="line number64 index64 alt1">&nbsp;</div><div class="line number65 index65 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">EnemyCollisionJob job </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">EnemyCollisionJob</code></div><div class="line number66 index66 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number67 index67 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">collisionDamage </code><code class="applescript color2">=</code> <code class="applescript color1">1</code><code class="applescript color1">,</code></div><div class="line number68 index68 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">playerRadius </code><code class="applescript color2">=</code> <code class="applescript plain">this.playerRadius</code><code class="applescript color1">,</code></div><div class="line number69 index69 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemyRadius </code><code class="applescript color2">=</code> <code class="applescript plain">this.enemyRadius</code><code class="applescript color1">,</code></div><div class="line number70 index70 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">playerPos </code><code class="applescript color2">=</code> <code class="applescript plain">playerPos</code><code class="applescript color1">,</code></div><div class="line number71 index71 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">positions </code><code class="applescript color2">=</code> <code class="applescript plain">enemyGroup.GetComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Position</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number72 index72 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">enemies </code><code class="applescript color2">=</code> <code class="applescript plain">enemyGroup.GetComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">Health</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code></div><div class="line number73 index73 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code><code class="applescript plain">;</code></div><div class="line number74 index74 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code> <code class="applescript plain">job.Schedule</code><code class="applescript color1">(</code><code class="applescript plain">enemyGroup.CalculateLength</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript color1">,</code> <code class="applescript color1">64</code><code class="applescript color1">,</code> <code class="applescript plain">inputDeps</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number75 index75 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number76 index76 alt1"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div><br>
<font size="3">最后别忘了加上移除死亡的敌人的系统，按照Unity官方的说法我们需要使用如下的格式进行实体的移除，要注意的是IJobProcessComponentData接口，继承这个接口可以获得所有的带有指定组件的实体。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="15">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="15">复制代码</em></div><div><div id="highlighter_170444" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div><div class="line number13 index13 alt2">13</div><div class="line number14 index14 alt1">14</div><div class="line number15 index15 alt2">15</div><div class="line number16 index16 alt1">16</div><div class="line number17 index17 alt2">17</div><div class="line number18 index18 alt1">18</div><div class="line number19 index19 alt2">19</div><div class="line number20 index20 alt1">20</div><div class="line number21 index21 alt2">21</div><div class="line number22 index22 alt1">22</div><div class="line number23 index23 alt2">23</div><div class="line number24 index24 alt1">24</div><div class="line number25 index25 alt2">25</div><div class="line number26 index26 alt1">26</div><div class="line number27 index27 alt2">27</div><div class="line number28 index28 alt1">28</div><div class="line number29 index29 alt2">29</div><div class="line number30 index30 alt1">30</div><div class="line number31 index31 alt2">31</div><div class="line number32 index32 alt1">32</div><div class="line number33 index33 alt2">33</div><div class="line number34 index34 alt1">34</div><div class="line number35 index35 alt2">35</div><div class="line number36 index36 alt1">36</div><div class="line number37 index37 alt2">37</div><div class="line number38 index38 alt1">38</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">RemoveDeadBarrier </code><code class="applescript color1">:</code> <code class="applescript plain">BarrierSystem</code></div><div class="line number1 index1 alt2"><code class="applescript color1">{</code></div><div class="line number2 index2 alt1"><code class="applescript color1">}</code></div><div class="line number3 index3 alt2"><code class="applescript plain">public </code><code class="applescript color3">class</code> <code class="applescript plain">RemoveDeadSystem </code><code class="applescript color1">:</code> <code class="applescript plain">JobComponentSystem</code></div><div class="line number4 index4 alt1"><code class="applescript color1">{</code></div><div class="line number5 index5 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct Player</code></div><div class="line number6 index6 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number7 index7 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public readonly int Length;</code></div><div class="line number8 index8 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[ReadOnly] public ComponentDataArray</code><code class="applescript color2">&lt;</code><code class="applescript plain">PlayerInput</code><code class="applescript color2">&gt;</code> <code class="applescript plain">PlayerInputs;</code></div><div class="line number9 index9 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number10 index10 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] Player player;</code></div><div class="line number11 index11 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[Inject] RemoveDeadBarrier barrier;</code></div><div class="line number12 index12 alt1">&nbsp;</div><div class="line number13 index13 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">[BurstCompile]</code></div><div class="line number14 index14 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">struct RemoveDeadJob </code><code class="applescript color1">:</code> <code class="applescript plain">IJobProcessComponentDataWithEntity</code><code class="applescript color2">&lt;</code><code class="applescript plain">Health</code><code class="applescript color2">&gt;</code></div><div class="line number15 index15 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number16 index16 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public bool PlayerDead;</code></div><div class="line number17 index17 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public EntityCommandBuffer Command;</code></div><div class="line number18 index18 alt1">&nbsp;</div><div class="line number19 index19 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">该方法会获取所有带有Health组件的实体。</code></div><div class="line number20 index20 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">public void Execute</code><code class="applescript color1">(</code><code class="applescript plain">Entity entity</code><code class="applescript color1">,</code> <code class="applescript plain">int </code><code class="applescript color3">index</code><code class="applescript color1">,</code> <code class="applescript plain">[ReadOnly] </code><code class="applescript keyword">ref</code> <code class="applescript plain">Health health</code><code class="applescript color1">)</code></div><div class="line number21 index21 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number22 index22 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">if</code> <code class="applescript color1">(</code><code class="applescript plain">health.Value </code><code class="applescript color2">&lt;</code><code class="applescript color2">=</code> <code class="applescript color1">0</code> <code class="applescript plain">|| PlayerDead</code><code class="applescript color1">)</code></div><div class="line number23 index23 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Command.DestroyEntity</code><code class="applescript color1">(</code><code class="applescript plain">entity</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number24 index24 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number25 index25 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number26 index26 alt1">&nbsp;</div><div class="line number27 index27 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">protected override JobHandle OnUpdate</code><code class="applescript color1">(</code><code class="applescript plain">JobHandle inputDeps</code><code class="applescript color1">)</code></div><div class="line number28 index28 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number29 index29 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">bool playerDead </code><code class="applescript color2">=</code> <code class="applescript plain">player.Length </code><code class="applescript color2">=</code><code class="applescript color2">=</code> <code class="applescript color1">0</code><code class="applescript plain">;</code></div><div class="line number30 index30 alt1">&nbsp;</div><div class="line number31 index31 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">RemoveDeadJob job </code><code class="applescript color2">=</code> <code class="applescript color3">new</code> <code class="applescript plain">RemoveDeadJob</code></div><div class="line number32 index32 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">{</code></div><div class="line number33 index33 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">PlayerDead </code><code class="applescript color2">=</code> <code class="applescript plain">playerDead</code><code class="applescript color1">,</code></div><div class="line number34 index34 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript plain">Command </code><code class="applescript color2">=</code> <code class="applescript plain">barrier.CreateCommandBuffer</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript color1">,</code></div><div class="line number35 index35 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code><code class="applescript plain">;</code></div><div class="line number36 index36 alt1"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript keyword">return</code> <code class="applescript plain">job.ScheduleSingle</code><code class="applescript color1">(</code><code class="applescript plain">this</code><code class="applescript color1">,</code> <code class="applescript plain">inputDeps</code><code class="applescript color1">)</code><code class="applescript plain">; </code><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">这里使用ScheduleSingle可以不需要指定Execute的指定顺序。</code></div><div class="line number37 index37 alt2"><code class="applescript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="applescript color1">}</code></div><div class="line number38 index38 alt1"><code class="applescript color1">}</code></div></div></td></tr></tbody></table></div></div></div></font><font size="3"><br>
</font><br>
<font size="3">最后，当然别忘了在Bootstrap.Start中初始化这三个系统：</font><br>
<font size="3"><br>
</font><br>
<div style="padding:15px 0;"><div style="font-size:12px;">[AppleScript] <em class="viewsource" style="cursor:pointer;font-size:12px;color:#369 !important;" num="16">纯文本查看</em> <em class="copycode" style="cursor:pointer;font-size:12px;color:#369 !important;" num="16">复制代码</em></div><div><div id="highlighter_2701" class="syntaxhighlighter notranslate applescript"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number0 index0 alt1 break">&nbsp;</div><div class="line number1 index1 alt2">01</div><div class="line number2 index2 alt1">02</div><div class="line number3 index3 alt2">03</div><div class="line number4 index4 alt1">04</div><div class="line number5 index5 alt2">05</div><div class="line number6 index6 alt1">06</div><div class="line number7 index7 alt2">07</div><div class="line number8 index8 alt1">08</div><div class="line number9 index9 alt2">09</div><div class="line number10 index10 alt1">10</div><div class="line number11 index11 alt2">11</div><div class="line number12 index12 alt1">12</div></td><td class="code"><div class="container"><div class="line number0 index0 alt1 break"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">初始化UI系统</code></div><div class="line number1 index1 alt2"><code class="applescript plain">UISystem uISystem </code><code class="applescript color2">=</code> <code class="applescript plain">World.Active.GetOrCreateManager</code><code class="applescript color2">&lt;</code><code class="applescript plain">UISystem</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number2 index2 alt1"><code class="applescript plain">uISystem.Init</code><code class="applescript color1">(</code><code class="applescript plain">enemyCount</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number3 index3 alt2">&nbsp;</div><div class="line number4 index4 alt1">&nbsp;</div><div class="line number5 index5 alt2"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">初始化敌人生成系统</code></div><div class="line number6 index6 alt1"><code class="applescript plain">EnemySpawnSystem enemySpawnSystem </code><code class="applescript color2">=</code> <code class="applescript plain">World.Active.GetOrCreateManager</code><code class="applescript color2">&lt;</code><code class="applescript plain">EnemySpawnSystem</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number7 index7 alt2"><code class="applescript plain">enemySpawnSystem.Init</code><code class="applescript color1">(</code><code class="applescript plain">manager</code><code class="applescript color1">,</code> <code class="applescript plain">enemyRenderer</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number8 index8 alt1">&nbsp;</div><div class="line number9 index9 alt2">&nbsp;</div><div class="line number10 index10 alt1"><code class="applescript color2">/</code><code class="applescript color2">/</code><code class="applescript plain">初始化敌人碰撞系统</code></div><div class="line number11 index11 alt2"><code class="applescript plain">EnemyCollisionSystem collisionSystem </code><code class="applescript color2">=</code> <code class="applescript plain">World.Active.GetOrCreateManager</code><code class="applescript color2">&lt;</code><code class="applescript plain">EnemyCollisionSystem</code><code class="applescript color2">&gt;</code><code class="applescript color1">(</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div><div class="line number12 index12 alt1"><code class="applescript plain">collisionSystem.Init</code><code class="applescript color1">(</code><code class="applescript plain">playerRenderer.mesh.</code><code class="applescript color3">bounds</code><code class="applescript plain">.size.x </code><code class="applescript color2">/</code> <code class="applescript color1">2</code><code class="applescript color1">,</code> <code class="applescript plain">enemyRenderer.mesh.</code><code class="applescript color3">bounds</code><code class="applescript plain">.size.x </code><code class="applescript color2">/</code> <code class="applescript color1">2</code><code class="applescript color1">)</code><code class="applescript plain">;</code></div></div></td></tr></tbody></table></div></div></div><br>
<br>
<br>
<font size="3">当这些系统都完成之后我们运行游戏看一下效果：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img id="aimg_171255" aid="171255" src="http://img.manew.com/data/attachment/forum/201812/07/150553rkrc6erdtr0qlkfc.gif" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150553rkrc6erdtr0qlkfc.gif" file="http://img.manew.com/data/attachment/forum/201812/07/150553rkrc6erdtr0qlkfc.gif" class="zoom" onclick="zoom(this, this.src, 0, 0, 0)" width="600" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1" style="">

<div class="tip tip_4 aimg_tip" id="aimg_171255_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>1.3.gif</strong> <em class="xg1">(3.47 MB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjU1fDYyNGYwZDhhfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171255" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171255&amp;handlekey=savephoto_171255">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:05">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><br>
<br>
<br>
<font size="3">效果是分毫不差的</font></font>

---

<font face="微软雅黑"><font size="3">终于，我们用两种方式都已经实现了该游戏，用Unity Profiler简单测试一下这两种方式的性能：</font><br>
<font size="3"><br>
</font><br>
<font size="3">测试机器的CPU（四核）与内存（8GB）：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>

<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171256" aid="171256" src="http://img.manew.com/data/attachment/forum/201812/07/150618enqrnnrrsrnreag1.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150618enqrnnrrsrnreag1.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150618enqrnnrrsrnreag1.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171256_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>10.jpg</strong> <em class="xg1">(8.05 KB, 下载次数: 1)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjU2fDkxNGNiZmM4fDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171256" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171256&amp;handlekey=savephoto_171256">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:06">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
<br>
<br>
<font size="3">测试环境：关闭了绝大部分进程，CPU空闲的情况下使用Unity2019.1 Editor运行游戏。</font><br>
<font size="3">测试方法：使用玩家小球朝着一个特定的方向移动。</font><br>
<font size="3"><br>
</font><br>
<font size="3">首先来看一下基于<strong>Monobehavior</strong>的实现：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171257" aid="171257" src="http://img.manew.com/data/attachment/forum/201812/07/150639wtko4e1j48tlvypq.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150639wtko4e1j48tlvypq.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150639wtko4e1j48tlvypq.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171257_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>11.jpg</strong> <em class="xg1">(38.39 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjU3fDNiYzMwMDYyfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171257" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171257&amp;handlekey=savephoto_171257">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:06">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</font>

<font face="微软雅黑"><br>
<br>
<br>
<font size="3">在敌人数量在17000左右时，游戏帧数掉到了30帧。</font><font size="3">由于没有使用Unity的物理系统，所以基本上是脚本跟渲染两大块占用CPU的性能。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<div align="center">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171258" aid="171258" src="http://img.manew.com/data/attachment/forum/201812/07/150656j4fuj8zl82bq7sj4.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150656j4fuj8zl82bq7sj4.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150656j4fuj8zl82bq7sj4.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171258_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>12.jpg</strong> <em class="xg1">(11.22 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjU4fDVjZmM0NGRlfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171258" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171258&amp;handlekey=savephoto_171258">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:06">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<br>
<br>
<font size="3">在主线程中一帧的时间已经超过30毫秒了，其中脚本执行就占用了几乎27毫秒。</font><br>
<font size="3"><div style="width: 600px; height: 146px;background: url(static/image/common/loading.gif) no-repeat center center;"></div><img id="aimg_FCsd3" onclick="zoom(this, this.src, 0, 0, 0)" class="zoom" width="600" height="146" file="https://pic1.zhimg.com/80/v2-d0e4171f0d1418984c37007c985c8a70_hd.jpg" onmouseover="img_onmouseoverfunc(this)" style="cursor: pointer; height: 1px; width: 1px;" border="0" alt="" src="https://pic1.zhimg.com/80/v2-d0e4171f0d1418984c37007c985c8a70_hd.jpg" lazyloaded="true"></font><font size="3">我们可以看到Job System上的线程也帮我们分担了不少渲染上的负担：</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171259" aid="171259" src="http://img.manew.com/data/attachment/forum/201812/07/150717qqb464foq46hh4f4.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150717qqb464foq46hh4f4.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150717qqb464foq46hh4f4.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171259_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>13.jpg</strong> <em class="xg1">(12.94 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjU5fGQ2ZjY5NWZhfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171259" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171259&amp;handlekey=savephoto_171259">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:07">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><br>
<br>
</font>

> <font face="微软雅黑"><font size="3">值得一提的是在unity2017之后加入了Job System，所以Unity的渲染也会被分配到不同的线程中去执行，在一定程度上提高了整体运行效率。</font></font>

<font face="微软雅黑"><font size="3">但在该游戏最吃性能的还是脚本，而我们希望在Job Sytem的不同工作线程中也能分担主线程中的脚本运行。</font><br>
<font size="3"><br>
</font><br>
<font size="3">所以我们测试一下加上了Job Sytem的<strong>Unity ECS</strong>实现：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑"><font size="3">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171260" aid="171260" src="http://img.manew.com/data/attachment/forum/201812/07/150739an131y3z393p3n3w.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150739an131y3z393p3n3w.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150739an131y3z393p3n3w.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171260_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>14.jpg</strong> <em class="xg1">(35.19 KB, 下载次数: 1)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjYwfDIwNmNkNjVkfDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171260" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171260&amp;handlekey=savephoto_171260">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:07">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font></font>

<font face="微软雅黑"><font size="3"><br>
</font></font>

<font face="微软雅黑"><font size="3"><br>
</font></font>

<font face="微软雅黑"><br>
<font size="3">同样在17000左右，ECS实现依然能维持85帧</font><font size="3"><br>
</font><font size="3">Job System的工作线程的确为主线程分担了相当一部分负担，并行化的脚本分配到了不同的工作线程上，利用了多核的性能。</font><br>
<font size="3"><br>
</font><br>
<font size="3"><br>
</font><br>
<div align="center">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171261" aid="171261" src="http://img.manew.com/data/attachment/forum/201812/07/150804d7hnn14y7177ciay.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150804d7hnn14y7177ciay.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150804d7hnn14y7177ciay.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171261_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>15.jpg</strong> <em class="xg1">(25.4 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjYxfDliN2E4MjQ3fDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171261" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171261&amp;handlekey=savephoto_171261">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:08">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
</div><br>
<font size="3"><br>
</font><font size="3">在不同Worker Thread中有蓝色的代码执行片段</font><font size="3"><br>
</font><font size="3">我们测试一下ECS的极限，看看实例化多少个单位会下降到30帧：</font><br>
<font size="3"><br>
</font><br>
</font>

<font face="微软雅黑">
<ignore_js_op>

<img style="cursor: pointer;" id="aimg_171262" aid="171262" src="http://img.manew.com/data/attachment/forum/201812/07/150828vv50ukkur73bfmvu.jpg.thumb.jpg" onclick="zoom(this, this.getAttribute('zoomfile'), 0, 0, '0')" zoomfile="http://img.manew.com/data/attachment/forum/201812/07/150828vv50ukkur73bfmvu.jpg" file="http://img.manew.com/data/attachment/forum/201812/07/150828vv50ukkur73bfmvu.jpg.thumb.jpg" inpost="1" onmouseover="showMenu({'ctrlid':this.id,'pos':'12'})" lazyloaded="true" _load="1">

<div class="tip tip_4 aimg_tip" id="aimg_171262_menu" style="position: absolute; display: none" disautofocus="true">
<div class="xs0">
<p><strong>16.jpg</strong> <em class="xg1">(35.58 KB, 下载次数: 0)</em></p>
<p>
<a href="http://www.manew.com/forum.php?mod=attachment&amp;aid=MTcxMjYyfGI2MTRhZGI4fDE1NDQ0MDQxNjN8Mjk4NzA5fDE0MjM5NA%3D%3D&amp;nothumb=yes" target="_blank">下载附件</a>

&nbsp;<a href="javascript:;" onclick="showWindow(this.id, this.getAttribute('url'), 'get', 0);" id="savephoto_171262" url="home.php?mod=spacecp&amp;ac=album&amp;op=saveforumphoto&amp;aid=171262&amp;handlekey=savephoto_171262">保存到相册</a>

</p>

<p class="xg1 y"><span title="2018-12-7 15:08">3&nbsp;天前</span> 上传</p>

</div>
<div class="tip_horn"></div>
</div>

</ignore_js_op>
<br>
</font>

<font face="微软雅黑"><br>
<font size="3">在敌人数量超过65000个时帧数下降到30帧</font><font size="3"><br>
</font><font size="3">差不多是惊人的65000个，几乎是Mono的4倍（因为充分利用了四个处理器核心）。</font><br>
<font size="3"><br>
</font><br>
<font size="3">从中我们可以看到，如果使用Unity开发某个拥有非常多相似的单位或是模型的游戏的时候使用Unity ECS会是不二之选。</font></font>_
